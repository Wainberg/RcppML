<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Project a factor model with least squares — project • RcppML</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Project a factor model with least squares — project" />
<meta property="og:description" content="Solves the equation \(A = wh\) for \(h\) given \(w\) and \(A\)" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RcppML</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/getting_started.html">Getting Started with NMF</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/zdebruine/RcppML/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Project a factor model with least squares</h1>
    <small class="dont-index">Source: <a href='https://github.com/zdebruine/RcppML/blob/master/R/project.R'><code>R/project.R</code></a></small>
    <div class="hidden name"><code>project.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Solves the equation \(A = wh\) for \(h\) given \(w\) and \(A\)</p>
    </div>

    <pre class="usage"><span class='fu'>project</span><span class='op'>(</span><span class='va'>model</span>, <span class='va'>newdata</span>, L1 <span class='op'>=</span> <span class='fl'>0</span>, nonneg <span class='op'>=</span> <span class='cn'>TRUE</span>, mask_zeros <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>model</th>
      <td><p>\(w\), matrix of features (rows) by factors (columns) containing the linear model to project</p></td>
    </tr>
    <tr>
      <th>newdata</th>
      <td><p>\(A\), data containing features (rows) by samples (columns) containing the new samples onto which to project the model</p></td>
    </tr>
    <tr>
      <th>L1</th>
      <td><p>L1/LASSO penalty to be applied. No scaling is performed. See details.</p></td>
    </tr>
    <tr>
      <th>nonneg</th>
      <td><p>enforce non-negativity</p></td>
    </tr>
    <tr>
      <th>mask_zeros</th>
      <td><p>handle zeros as missing values</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>matrix \(h\)</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>For the alternating least squares matrix factorization update problem \(A = wh\), the updates
(or projection) of \(h\) is given by the equation: $$w^Twh = wA_j$$
which is in the form \(ax = b\) where \(a = w^Tw\) \(x = h\) and \(b = wA_j\) for all columns \(j\) in \(A\).</p>
<p>Least squares projections in factorizations of rank-3 and greater are parallelized using the number of threads set by <code><a href='getRcppMLthreads.html'>setRcppMLthreads</a></code>.</p>
<p>Any L1 penalty is subtracted from \(b\) and should generally be scaled to <code><a href='https://rdrr.io/r/base/Extremes.html'>max(b)</a></code>, where \(b = WA_j\) for all columns \(j\) in \(A\). An easy way to properly scale an L1 penalty is to normalize all columns in \(w\) to sum to the same value (e.g. 1). No scaling is applied in this function. Such scaling guarantees that <code>L1 = 1</code> gives a completely sparse solution.</p>
<p>There are specializations for dense and sparse input matrices, symmetric input matrices, and for rank-1 and rank-2 projections. See documentation for <code><a href='nmf.html'>nmf</a></code> for theoretical details and guidance.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>DeBruine, ZJ, Melcher, K, and Triche, TJ. (2021). "High-performance non-negative matrix factorization for large single-cell data." BioRXiv.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='nnls.html'>nnls</a></code>, <code><a href='nmf.html'>nmf</a></code></p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Zach DeBruine</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://Matrix.R-forge.R-project.org/'>Matrix</a></span><span class='op'>)</span>
<span class='va'>w</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fl'>1000</span> <span class='op'>*</span> <span class='fl'>10</span><span class='op'>)</span>, <span class='fl'>1000</span>, <span class='fl'>10</span><span class='op'>)</span>
<span class='va'>h_true</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fl'>10</span> <span class='op'>*</span> <span class='fl'>100</span><span class='op'>)</span>, <span class='fl'>10</span>, <span class='fl'>100</span><span class='op'>)</span>
<span class='co'># A is the crossproduct of "w" and "h" with 10% signal dropout</span>
<span class='va'>A</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>w</span> <span class='op'>%*%</span> <span class='va'>h_true</span><span class='op'>)</span> <span class='op'>*</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/Matrix/man/rsparsematrix.html'>rsparsematrix</a></span><span class='op'>(</span><span class='fl'>1000</span>, <span class='fl'>100</span>, <span class='fl'>0.9</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span>
<span class='va'>h</span> <span class='op'>&lt;-</span> <span class='fu'>project</span><span class='op'>(</span><span class='va'>A</span>, <span class='va'>w</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='va'>h_true</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='va'>h</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># alternating projections refine solution (like NMF)</span>
<span class='va'>mse_bad</span> <span class='op'>&lt;-</span> <span class='fu'><a href='mse.html'>mse</a></span><span class='op'>(</span><span class='va'>A</span>, <span class='va'>w</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span><span class='op'>)</span>, <span class='va'>h</span><span class='op'>)</span> <span class='co'># mse before alternating updates</span>
<span class='va'>h</span> <span class='op'>&lt;-</span> <span class='fu'>project</span><span class='op'>(</span><span class='va'>A</span>, w <span class='op'>=</span> <span class='va'>w</span><span class='op'>)</span>
<span class='va'>w</span> <span class='op'>&lt;-</span> <span class='fu'>project</span><span class='op'>(</span><span class='va'>A</span>, h <span class='op'>=</span> <span class='va'>h</span><span class='op'>)</span>
<span class='va'>h</span> <span class='op'>&lt;-</span> <span class='fu'>project</span><span class='op'>(</span><span class='va'>A</span>, <span class='va'>w</span><span class='op'>)</span>
<span class='va'>w</span> <span class='op'>&lt;-</span> <span class='fu'>project</span><span class='op'>(</span><span class='va'>A</span>, h <span class='op'>=</span> <span class='va'>h</span><span class='op'>)</span>
<span class='va'>h</span> <span class='op'>&lt;-</span> <span class='fu'>project</span><span class='op'>(</span><span class='va'>A</span>, <span class='va'>w</span><span class='op'>)</span>
<span class='va'>w</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='fu'>project</span><span class='op'>(</span><span class='va'>A</span>, h <span class='op'>=</span> <span class='va'>h</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>mse_better</span> <span class='op'>&lt;-</span> <span class='fu'><a href='mse.html'>mse</a></span><span class='op'>(</span><span class='va'>A</span>, <span class='va'>w</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span><span class='op'>)</span>, <span class='va'>h</span><span class='op'>)</span> <span class='co'># mse after alternating updates</span>
<span class='va'>mse_better</span> <span class='op'>&lt;</span> <span class='va'>mse_bad</span>

<span class='co'># two ways to solve for "w" that give the same solution</span>
<span class='va'>w</span> <span class='op'>&lt;-</span> <span class='fu'>project</span><span class='op'>(</span><span class='va'>A</span>, h <span class='op'>=</span> <span class='va'>h</span><span class='op'>)</span>
<span class='va'>w2</span> <span class='op'>&lt;-</span> <span class='fu'>project</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>A</span><span class='op'>)</span>, w <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>h</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span><span class='op'>(</span><span class='va'>w</span>, <span class='va'>w2</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Zach DeBruine.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


