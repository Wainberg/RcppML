Build RcppML functions
```{r}
#Rcpp::sourceCpp("src/RcppFunctions.cpp")
#source("R/svd.R")
library(RcppML)
```

Generate rank 5 matrix for testing

```{r}
options(RcppML.threads = 7)
options(RcppML.verbose = FALSE)
A <- matrix(1:100, nrow=10, ncol=10)
```

Now generate and compare approximations based on IRLBA and RcppML
```{r}
m_rcppml <- svd_rcppml(A, 3)
#A_rcppml <- (m_rcppml$u * m_rcppml$d) %*% t(m_rcppml$v)
A_rcppml <- (m_rcppml$u %*% diag(m_rcppml$d)) %*% t(m_rcppml$v)
m_irlba <- irlba::irlba(A, 3)
#A_irlba <- (m_irlba$u * m_irlba$d) %*% t(m_irlba$v)
A_irlba <- (m_irlba$u %*% diag(m_irlba$d)) %*% t(m_irlba$v)

diff <- sum(A_irlba - A_rcppml)
print(diff)

plot(1:length(as.vector(A_irlba)), as.vector(A_irlba), type='l', col='green')
lines(1:length(as.vector(A_rcppml)), as.vector(A_rcppml), col='red')
```

Compare the runtime of RcppML vs irlba
Check average time over 10 restarts, using the same data. 

```{r}
library(microbenchmark)
data("hawaiibirds")
A <- hawaiibirds$counts
mbm <- microbenchmark(
  "RcppML" = {
    model <- svd_rcppml(A, 10)
  },
  "irlba" = {
    model <- irlba::irlba(A, 10)
  }
)
mbm
```

```{r}
data("aml")
A <- aml$data
mbm <- microbenchmark(
  "RcppML" = {
    model <- svd_rcppml(A, 10)
  },
  "irlba" = {
    model <- irlba::irlba(A, 10)
  }
)
mbm
```